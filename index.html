<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C&M - Controle de Consultor (Reservas)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --cor-laranja: #F5A623;
            --cor-verde: #C8D946;
            --cor-turquesa: #4ECDC4;
            --cor-escuro: #2C5F5D;
        }
        .bg-cm-escuro { background-color: var(--cor-escuro); }
        .bg-cm-laranja { background-color: var(--cor-laranja); }
        .bg-cm-verde { background-color: var(--cor-verde); }
        .bg-cm-turquesa { background-color: var(--cor-turquesa); }
        .text-cm-escuro { color: var(--cor-escuro); }
        .text-cm-laranja { color: var(--cor-laranja); }
        .text-cm-verde { color: var(--cor-verde); }
        .text-cm-turquesa { color: var(--cor-turquesa); }
        .btn-cm { background: linear-gradient(135deg, var(--cor-laranja), var(--cor-verde), var(--cor-turquesa)); }
        .btn-cm:hover { opacity: 0.9; }
        .modal { display: none; position: fixed; z-index: 50; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal.active { display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        class ControlConsultor {
            constructor() {
                this.loggedIn = false;
                this.userName = '';
                this.currentPage = 'dashboard';
                this.vendas = [];
                this.comissaoPadrao = 5;
                this.filtroDataInicio = this.getDataMesAtual();
                this.filtroDataFim = this.getDataAtual();
                this.editingId = null;
                
                // Hist√≥rico de desempenho di√°rio
                this.historicoDesempenho = [];
                
                // Rotina de Trabalho
                this.rotinaTrabalho = [
                    {
                        id: 1,
                        horario: '08:00 √†s 08:30',
                        etiqueta: 'Novo Cliente',
                        cor: 'bg-green-500',
                        tarefas: [
                            'Chamar TODOS novos clientes do LL',
                            'Verificar etiqueta novo cliente',
                            'Etiquetar conforme o fluxo de etiquetas'
                        ],
                        completo: false
                    },
                    {
                        id: 2,
                        horario: '08:30 √†s 11:00',
                        etiqueta: 'Atendimento',
                        cor: 'bg-blue-500',
                        tarefas: [
                            'Interagir com TODOS os clientes',
                            'Etiquetar conforme o fluxo de etiquetas'
                        ],
                        completo: false
                    },
                    {
                        id: 3,
                        horario: '11:00 √†s 12:00',
                        etiqueta: 'Aguardando Pagamento',
                        cor: 'bg-red-500',
                        tarefas: [
                            'Lembrar fechamento cobrar leve',
                            'Follow-up em atendimento'
                        ],
                        completo: false
                    },
                    {
                        id: 4,
                        horario: '12:00 √†s 13:30',
                        etiqueta: 'Almo√ßo',
                        cor: 'bg-green-600',
                        tarefas: [
                            'Intervalo para almo√ßo'
                        ],
                        completo: false
                    },
                    {
                        id: 5,
                        horario: '13:30 √†s 14:00',
                        etiqueta: 'N√£o Responde',
                        cor: 'bg-yellow-500',
                        tarefas: [
                            'Prospectar 25 clientes antigos'
                        ],
                        completo: false
                    },
                    {
                        id: 6,
                        horario: '14:00 √†s 16:00',
                        etiqueta: 'Atendimento',
                        cor: 'bg-blue-500',
                        tarefas: [
                            'Interagir com TODOS os clientes',
                            'Finalizar TODOS or√ßamentos da etiqueta',
                            'Etiquetar conforme o fluxo de etiquetas'
                        ],
                        completo: false
                    },
                    {
                        id: 7,
                        horario: '16:00 √†s 16:30',
                        etiqueta: 'Analisando',
                        cor: 'bg-yellow-500',
                        tarefas: [
                            'Prospectar 25 clientes antigos'
                        ],
                        completo: false
                    },
                    {
                        id: 8,
                        horario: '16:30 √†s 18:00',
                        etiqueta: 'Aguardando Pagamento',
                        cor: 'bg-red-500',
                        tarefas: [
                            'Buscar fechamento com TODOS da etiqueta',
                            'Conferir se contatos do dia tem etiqueta',
                            'Lan√ßar vendas do dia no LL'
                        ],
                        completo: false
                    }
                ];
                
                this.editingRotinaId = null;
                
                this.carregarDados();
                this.render();
            }

            getDataAtual() {
                return new Date().toISOString().split('T')[0];
            }

            getDataMesAtual() {
                const hoje = new Date();
                const primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                return primeiroDia.toISOString().split('T')[0];
            }

            carregarDados() {
                const dados = localStorage.getItem('appCMReservas');
                if (dados) {
                    const { vendas, comissao, rotinaTrabalho, historicoDesempenho } = JSON.parse(dados);
                    this.vendas = vendas || [];
                    this.comissaoPadrao = comissao || 5;
                    if (rotinaTrabalho) this.rotinaTrabalho = rotinaTrabalho;
                    if (historicoDesempenho) this.historicoDesempenho = historicoDesempenho;
                }
            }

            salvarDados() {
                localStorage.setItem('appCMReservas', JSON.stringify({
                    vendas: this.vendas,
                    comissao: this.comissaoPadrao,
                    rotinaTrabalho: this.rotinaTrabalho,
                    historicoDesempenho: this.historicoDesempenho
                }));
            }

            login(nome) {
                if (nome.trim()) {
                    this.userName = nome;
                    this.loggedIn = true;
                    this.render();
                }
            }

            logout() {
                this.loggedIn = false;
                this.userName = '';
                this.render();
            }

            toggleTarefaCompleta(id) {
                const item = this.rotinaTrabalho.find(r => r.id === id);
                if (item) {
                    item.completo = !item.completo;
                    this.salvarDados();
                    this.render();
                }
            }

            salvarDiaNoHistorico() {
                const hoje = this.getDataAtual();
                const tarefasCompletas = this.rotinaTrabalho.filter(t => t.completo).length;
                const totalTarefas = this.rotinaTrabalho.length;
                const percentual = Math.round((tarefasCompletas / totalTarefas) * 100);

                // Remove registro do mesmo dia se existir
                this.historicoDesempenho = this.historicoDesempenho.filter(h => h.data !== hoje);
                
                // Adiciona novo registro
                this.historicoDesempenho.push({
                    data: hoje,
                    tarefasCompletas,
                    totalTarefas,
                    percentual,
                    detalhes: this.rotinaTrabalho.map(r => ({
                        etiqueta: r.etiqueta,
                        completo: r.completo
                    }))
                });

                this.salvarDados();
                alert(`‚úÖ Dia registrado! Voc√™ completou ${percentual}% das tarefas hoje.`);
            }

            resetarRotina() {
                if (confirm('Deseja resetar todas as tarefas da rotina?')) {
                    this.rotinaTrabalho.forEach(item => item.completo = false);
                    this.salvarDados();
                    alert('Rotina resetada com sucesso!');
                    this.render();
                }
            }

            abrirModalEditarRotina(id) {
                this.editingRotinaId = id;
                this.render();
                setTimeout(() => {
                    document.getElementById('modalEditarRotina').classList.add('active');
                }, 100);
            }

            fecharModalEditarRotina() {
                this.editingRotinaId = null;
                document.getElementById('modalEditarRotina')?.classList.remove('active');
            }

            salvarEdicaoRotina() {
                const item = this.rotinaTrabalho.find(r => r.id === this.editingRotinaId);
                if (!item) return;

                const horario = document.getElementById('editHorario')?.value || '';
                const etiqueta = document.getElementById('editEtiqueta')?.value || '';
                const cor = document.getElementById('editCor')?.value || 'bg-blue-500';
                const tarefasText = document.getElementById('editTarefas')?.value || '';
                const tarefas = tarefasText.split('\n').filter(t => t.trim());

                if (!horario || !etiqueta || tarefas.length === 0) {
                    alert('Preencha todos os campos!');
                    return;
                }

                item.horario = horario;
                item.etiqueta = etiqueta;
                item.cor = cor;
                item.tarefas = tarefas;

                this.salvarDados();
                this.fecharModalEditarRotina();
                alert('Bloco de rotina atualizado!');
                this.render();
            }

            adicionarBlocoRotina() {
                const novoId = Math.max(...this.rotinaTrabalho.map(r => r.id)) + 1;
                this.rotinaTrabalho.push({
                    id: novoId,
                    horario: '18:00 √†s 19:00',
                    etiqueta: 'Nova Tarefa',
                    cor: 'bg-gray-500',
                    tarefas: ['Adicione suas tarefas aqui'],
                    completo: false
                });
                this.salvarDados();
                this.render();
            }

            deletarBlocoRotina(id) {
                if (confirm('Deletar este bloco de rotina?')) {
                    this.rotinaTrabalho = this.rotinaTrabalho.filter(r => r.id !== id);
                    this.salvarDados();
                    this.render();
                }
            }

            getHistoricoMesAtual() {
                const hoje = new Date();
                const mesAtual = hoje.getMonth();
                const anoAtual = hoje.getFullYear();
                
                return this.historicoDesempenho.filter(h => {
                    const dataHist = new Date(h.data);
                    return dataHist.getMonth() === mesAtual && dataHist.getFullYear() === anoAtual;
                });
            }

            getDicasPersonalizadas() {
                const historicoMes = this.getHistoricoMesAtual();
                if (historicoMes.length === 0) {
                    return {
                        inicio: 'üöÄ Voc√™ est√° come√ßando! Marque suas tarefas diariamente e clique em "Salvar Dia" para acompanhar seu progresso.',
                        dicas: [
                            'Comece marcando as tarefas mais importantes da manh√£',
                            'Use a rotina como guia para n√£o esquecer nenhum cliente',
                            'Ao final do dia, clique em "Salvar Dia" para registrar seu desempenho'
                        ]
                    };
                }

                const mediaPercentual = historicoMes.reduce((sum, h) => sum + h.percentual, 0) / historicoMes.length;
                const tarefasMaisIncompletas = this.analisarTarefasIncompletas(historicoMes);
                
                let mensagemPrincipal = '';
                let dicas = [];

                if (mediaPercentual >= 90) {
                    mensagemPrincipal = 'üèÜ EXCELENTE! Voc√™ est√° com desempenho excepcional! Continue assim!';
                    dicas = [
                        'Voc√™ √© um exemplo de disciplina! Mantenha esse ritmo',
                        'Considere compartilhar suas estrat√©gias com a equipe',
                        'Foque em otimizar o tempo de cada tarefa agora'
                    ];
                } else if (mediaPercentual >= 75) {
                    mensagemPrincipal = 'üëç MUITO BOM! Voc√™ est√° no caminho certo, mas pode melhorar ainda mais!';
                    dicas = [
                        `Aten√ß√£o especial para: ${tarefasMaisIncompletas[0] || 'todas as tarefas'}`,
                        'Tente completar pelo menos 90% das tarefas di√°rias',
                        'Reserve os √∫ltimos 30min do dia para finalizar pend√™ncias'
                    ];
                } else if (mediaPercentual >= 60) {
                    mensagemPrincipal = '‚ö†Ô∏è ATEN√á√ÉO! Seu desempenho est√° abaixo do ideal. Vamos melhorar?';
                    dicas = [
                        `Principais dificuldades em: ${tarefasMaisIncompletas.slice(0, 2).join(', ')}`,
                        'Defina alarmes para cada bloco de hor√°rio',
                        'Comece pelas tarefas mais dif√≠ceis pela manh√£',
                        'Pe√ßa ajuda ao gestor se necess√°rio'
                    ];
                } else {
                    mensagemPrincipal = 'üö® URGENTE! Seu desempenho precisa melhorar imediatamente!';
                    dicas = [
                        'Converse com seu gestor sobre as dificuldades',
                        'Revise sua rotina e ajuste os hor√°rios',
                        'Foque em completar pelo menos 5 tarefas por dia',
                        'Elimine distra√ß√µes durante o expediente',
                        'Considere fazer um checklist f√≠sico tamb√©m'
                    ];
                }

                return { inicio: mensagemPrincipal, dicas };
            }

            analisarTarefasIncompletas(historico) {
                const contagem = {};
                
                historico.forEach(dia => {
                    dia.detalhes.forEach(det => {
                        if (!det.completo) {
                            contagem[det.etiqueta] = (contagem[det.etiqueta] || 0) + 1;
                        }
                    });
                });

                return Object.entries(contagem)
                    .sort((a, b) => b[1] - a[1])
                    .map(([etiqueta, _]) => etiqueta);
            }

            getVendasFiltradas() {
                return this.vendas.filter(v => {
                    const dataVenda = new Date(v.dataConfirmacao);
                    const dataInicio = new Date(this.filtroDataInicio);
                    const dataFim = new Date(this.filtroDataFim);
                    dataFim.setHours(23, 59, 59, 999);
                    return dataVenda >= dataInicio && dataVenda <= dataFim;
                });
            }

            exportarExcel() {
                const vendsFiltradas = this.getVendasFiltradas();
                
                const dados = vendsFiltradas.map(v => ({
                    'Tipo Cliente': v.tipoCliente,
                    'Nome Cliente': v.nomeCliente,
                    'Check-in': v.checkIn,
                    'Check-out': v.checkOut,
                    'Hotel': v.hotel,
                    'Valor (R$)': v.valor.toFixed(2),
                    'Situa√ß√£o': v.situacao,
                    'Agente': v.agente,
                    'Voucher': v.voucher,
                    'Data Confirma√ß√£o': v.dataConfirmacao,
                    'Observa√ß√µes': v.observacoes || ''
                }));

                const totalVendido = vendsFiltradas.reduce((sum, v) => sum + parseFloat(v.valor || 0), 0);
                const totalComissao = (totalVendido * this.comissaoPadrao) / 100;

                dados.push({});
                dados.push({ 'Tipo Cliente': 'RESUMO DO PER√çODO' });
                dados.push({ 'Tipo Cliente': 'Total de Vendas', 'Nome Cliente': vendsFiltradas.length });
                dados.push({ 'Tipo Cliente': 'Valor Total (R$)', 'Nome Cliente': totalVendido.toFixed(2) });
                dados.push({ 'Tipo Cliente': `Comiss√£o ${this.comissaoPadrao}% (R$)`, 'Nome Cliente': totalComissao.toFixed(2) });

                const ws = XLSX.utils.json_to_sheet(dados);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Vendas');
                
                XLSX.writeFile(wb, `C&M_Relatorio_Vendas_${new Date().toISOString().split('T')[0]}.xlsx`);
            }

            renderGraficos() {
                setTimeout(() => {
                    this.renderGraficoDesempenho();
                    this.renderGraficoTarefas();
                }, 100);
            }

            renderGraficoDesempenho() {
                const ctx = document.getElementById('graficoDesempenho');
                if (!ctx) return;

                const historicoMes = this.getHistoricoMesAtual();
                const labels = historicoMes.map(h => {
                    const data = new Date(h.data);
                    return `${data.getDate()}/${data.getMonth() + 1}`;
                });
                const dados = historicoMes.map(h => h.percentual);

                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [{
                            label: 'Desempenho Di√°rio (%)',
                            data: dados,
                            borderColor: '#4ECDC4',
                            backgroundColor: 'rgba(78, 205, 196, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            renderGraficoTarefas() {
                const ctx = document.getElementById('graficoTarefas');
                if (!ctx) return;

                const historicoMes = this.getHistoricoMesAtual();
                const tarefas = {};

                // Contar conclus√µes por etiqueta
                historicoMes.forEach(dia => {
                    dia.detalhes.forEach(det => {
                        if (!tarefas[det.etiqueta]) {
                            tarefas[det.etiqueta] = { completo: 0, total: 0 };
                        }
                        tarefas[det.etiqueta].total++;
                        if (det.completo) tarefas[det.etiqueta].completo++;
                    });
                });

                const labels = Object.keys(tarefas);
                const percentuais = labels.map(label => {
                    const t = tarefas[label];
                    return Math.round((t.completo / t.total) * 100);
                });

                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels,
                        datasets: [{
                            label: 'Taxa de Conclus√£o (%)',
                            data: percentuais,
                            backgroundColor: [
                                '#C8D946',
                                '#4ECDC4',
                                '#F5A623',
                                '#2C5F5D',
                                '#10B981',
                                '#3B82F6',
                                '#EF4444',
                                '#8B5CF6'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            render() {
                const app = document.getElementById('app');
                
                if (!this.loggedIn) {
                    app.innerHTML = `
                        <div class="min-h-screen bg-cm-escuro flex items-center justify-center p-4">
                            <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md">
                                <div class="flex justify-center mb-8">
                                    <div class="flex gap-2">
                                        <div class="w-16 h-20 bg-cm-laranja rounded flex items-center justify-center">
                                            <span class="text-cm-escuro text-4xl font-bold">C</span>
                                        </div>
                                        <div class="w-16 h-20 bg-cm-verde rounded flex items-center justify-center">
                                            <span class="text-cm-escuro text-4xl font-bold">&</span>
                                        </div>
                                        <div class="w-16 h-20 bg-cm-turquesa rounded flex items-center justify-center">
                                            <span class="text-cm-escuro text-4xl font-bold">M</span>
                                        </div>
                                    </div>
                                </div>
                                <h1 class="text-2xl font-bold text-center text-cm-escuro mb-2">Controle de Consultor</h1>
                                <p class="text-gray-600 text-center mb-6 text-sm">Parques & Resorts - Gest√£o de Reservas</p>
                                <input type="text" id="loginInput" placeholder="Digite seu nome" class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:border-cm-turquesa" />
                                <button onclick="app.login(document.getElementById('loginInput').value)" class="w-full btn-cm text-white py-3 rounded-lg font-semibold transition">Entrar</button>
                            </div>
                        </div>
                    `;
                    return;
                }

                let conteudo = '';

                if (this.currentPage === 'desempenho') {
                    const historicoMes = this.getHistoricoMesAtual();
                    const mediaPercentual = historicoMes.length > 0 
                        ? historicoMes.reduce((sum, h) => sum + h.percentual, 0) / historicoMes.length 
                        : 0;
                    
                    const diasTrabalhados = historicoMes.length;
                    const melhorDia = historicoMes.length > 0 
                        ? historicoMes.reduce((max, h) => h.percentual > max.percentual ? h : max)
                        : null;

                    const dicas = this.getDicasPersonalizadas();

                    conteudo = `
                        <div>
                            <h2 class="text-2xl font-bold mb-6 text-cm-escuro">üìä Dashboard de Desempenho</h2>

                            <!-- Cards de Estat√≠sticas -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                                <div class="bg-white p-6 rounded-lg shadow border-t-4 border-cm-laranja">
                                    <p class="text-gray-600 text-sm">Desempenho M√©dio</p>
                                    <p class="text-4xl font-bold text-cm-escuro">${mediaPercentual.toFixed(0)}%</p>
                                    <p class="text-xs text-gray-500 mt-2">Este m√™s</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow border-t-4 border-cm-verde">
                                    <p class="text-gray-600 text-sm">Dias Trabalhados</p>
                                    <p class="text-4xl font-bold text-cm-escuro">${diasTrabalhados}</p>
                                    <p class="text-xs text-gray-500 mt-2">Registrados no sistema</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow border-t-4 border-cm-turquesa">
                                    <p class="text-gray-600 text-sm">Melhor Dia</p>
                                    <p class="text-4xl font-bold text-cm-escuro">${melhorDia ? melhorDia.percentual + '%' : '--'}</p>
                                    <p class="text-xs text-gray-500 mt-2">${melhorDia ? new Date(melhorDia.data).toLocaleDateString('pt-BR') : 'Nenhum registro'}</p>
                                </div>
                            </div>

                            <!-- Dicas Personalizadas -->
                            <div class="bg-gradient-to-r from-blue-50 to-green-50 p-6 rounded-lg shadow mb-8 border-l-4 border-cm-turquesa">
                                <h3 class="text-xl font-bold mb-4 text-cm-escuro">üí° An√°lise e Dicas Personalizadas</h3>
                                <p class="text-lg font-semibold mb-4 text-gray-700">${dicas.inicio}</p>
                                <ul class="space-y-2">
                                    ${dicas.dicas.map(dica => `
                                        <li class="flex items-start gap-3">
                                            <span class="text-cm-verde text-xl">‚úì</span>
                                            <span class="text-gray-700">${dica}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>

                            ${historicoMes.length === 0 ? `
                                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 rounded-lg shadow mb-8">
                                    <h3 class="text-lg font-bold text-yellow-800 mb-2">‚ö†Ô∏è Como Come√ßar?</h3>
                                    <ol class="list-decimal list-inside space-y-2 text-gray-700">
                                        <li>V√° para a aba <strong>"‚úÖ Rotina"</strong></li>
                                        <li>Marque as tarefas que voc√™ completar durante o dia</li>
                                        <li>No final do expediente, clique em <strong>"üíæ Salvar Dia"</strong></li>
                                        <li>Volte aqui para ver seus gr√°ficos e an√°lises!</li>
                                    </ol>
                                </div>
                            ` : `
                                <!-- Gr√°ficos -->
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                                    <div class="bg-white p-6 rounded-lg shadow">
                                        <h3 class="text-lg font-bold mb-4 text-cm-escuro">Evolu√ß√£o do Desempenho</h3>
                                        <div style="height: 300px;">
                                            <canvas id="graficoDesempenho"></canvas>
                                        </div>
                                    </div>
                                    <div class="bg-white p-6 rounded-lg shadow">
                                        <h3 class="text-lg font-bold mb-4 text-cm-escuro">Taxa de Conclus√£o por Tarefa</h3>
                                        <div style="height: 300px;">
                                            <canvas id="graficoTarefas"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Hist√≥rico Detalhado -->
                                <div class="bg-white p-6 rounded-lg shadow">
                                    <h3 class="text-lg font-bold mb-4 text-cm-escuro">Hist√≥rico Detalhado do M√™s</h3>
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm">
                                            <thead class="bg-cm-escuro text-white">
                                                <tr>
                                                    <th class="px-4 py-2 text-left">Data</th>
                                                    <th class="px-4 py-2 text-left">Completas</th>
                                                    <th class="px-4 py-2 text-left">Total</th>
                                                    <th class="px-4 py-2 text-left">Desempenho</th>
                                                    <th class="px-4 py-2 text-left">Avalia√ß√£o</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${historicoMes.sort((a, b) => new Date(b.data) - new Date(a.data)).map((h, i) => `
                                                    <tr class="border-b ${i % 2 === 0 ? 'bg-gray-50' : ''}">
                                                        <td class="px-4 py-2 font-semibold">${new Date(h.data).toLocaleDateString('pt-BR')}</td>
                                                        <td class="px-4 py-2">${h.tarefasCompletas}</td>
                                                        <td class="px-4 py-2">${h.totalTarefas}</td>
                                                        <td class="px-4 py-2">
                                                            <div class="flex items-center gap-2">
                                                                <div class="w-20 bg-gray-200 rounded-full h-2">
                                                                    <div class="bg-cm-verde h-2 rounded-full" style="width: ${h.percentual}%"></div>
                                                                </div>
                                                                <span class="font-bold text-cm-escuro">${h.percentual}%</span>
                                                            </div>
                                                        </td>
                                                        <td class="px-4 py-2">
                                                            ${h.percentual >= 90 ? 'üèÜ Excelente' : 
                                                              h.percentual >= 75 ? 'üëç Bom' : 
                                                              h.percentual >= 60 ? '‚ö†Ô∏è Regular' : 
                                                              'üö® Fraco'}
                                                        </td>
                                                    </tr>
                                                `).join('')}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            `}
                        </div>
                    `;

                    // Renderizar gr√°ficos ap√≥s o DOM estar pronto
                    if (historicoMes.length > 0) {
                        this.renderGraficos();
                    }
                }

                else if (this.currentPage === 'rotina') {
                    const tarefasCompletas = this.rotinaTrabalho.filter(t => t.completo).length;
                    const totalTarefas = this.rotinaTrabalho.length;
                    const percentualCompleto = Math.round((tarefasCompletas / totalTarefas) * 100);

                    conteudo = `
                        <div>
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold text-cm-escuro">‚úÖ Rotina de Trabalho</h2>
                                <div class="flex gap-2">
                                    <button onclick="app.salvarDiaNoHistorico()" class="bg-cm-laranja hover:opacity-90 text-white px-4 py-2 rounded-lg font-semibold">üíæ Salvar Dia</button>
                                    <button onclick="app.adicionarBlocoRotina()" class="bg-cm-verde hover:opacity-90 text-cm-escuro px-4 py-2 rounded-lg font-semibold">‚ûï Adicionar</button>
                                    <button onclick="app.resetarRotina()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-semibold">üîÑ Resetar</button>
                                </div>
                            </div>

                            <!-- Barra de Progresso -->
                            <div class="bg-white p-6 rounded-lg shadow mb-6">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="text-lg font-bold text-cm-escuro">Progresso do Dia</h3>
                                    <span class="text-2xl font-bold text-cm-turquesa">${percentualCompleto}%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-4">
                                    <div class="bg-cm-verde h-4 rounded-full transition-all duration-500" style="width: ${percentualCompleto}%"></div>
                                </div>
                                <p class="text-gray-600 text-sm mt-2">${tarefasCompletas} de ${totalTarefas} blocos completados</p>
                                <p class="text-xs text-orange-600 mt-3">üí° Ao final do dia, clique em "üíæ Salvar Dia" para registrar seu desempenho!</p>
                            </div>

                            <!-- Cards de Tarefas -->
                            <div class="grid grid-cols-1 gap-4">
                                ${this.rotinaTrabalho.map(item => `
                                    <div class="bg-white rounded-lg shadow-lg overflow-hidden ${item.completo ? 'opacity-75' : ''}">
                                        <div class="${item.cor} text-white p-4 flex justify-between items-center">
                                            <div>
                                                <h3 class="text-xl font-bold">${item.horario}</h3>
                                                <p class="text-sm opacity-90">${item.etiqueta}</p>
                                            </div>
                                            <div class="flex gap-2">
                                                <button onclick="app.abrirModalEditarRotina(${item.id})" class="bg-white bg-opacity-20 hover:bg-opacity-30 p-2 rounded transition" title="Editar">
                                                    ‚úèÔ∏è
                                                </button>
                                                <button onclick="app.deletarBlocoRotina(${item.id})" class="bg-white bg-opacity-20 hover:bg-opacity-30 p-2 rounded transition" title="Deletar">
                                                    üóëÔ∏è
                                                </button>
                                                <button onclick="app.toggleTarefaCompleta(${item.id})" class="bg-white bg-opacity-20 hover:bg-opacity-30 p-2 rounded transition">
                                                    ${item.completo ? '‚úÖ' : '‚≠ï'}
                                                </button>
                                            </div>
                                        </div>
                                        <div class="p-4">
                                            <h4 class="font-bold mb-3 text-gray-700">O que fazer:</h4>
                                            <ul class="space-y-2">
                                                ${item.tarefas.map(tarefa => `
                                                    <li class="flex items-start gap-2">
                                                        <span class="text-cm-turquesa font-bold">‚Ä¢</span>
                                                        <span class="${item.completo ? 'line-through text-gray-400' : 'text-gray-700'}">${tarefa}</span>
                                                    </li>
                                                `).join('')}
                                            </ul>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Modal Editar Rotina -->
                        <div id="modalEditarRotina" class="modal">
                            <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-2xl m-4">
                                <h3 class="text-xl font-bold text-cm-escuro mb-4">‚úèÔ∏è Editar Bloco de Rotina</h3>
                                ${this.editingRotinaId ? (() => {
                                    const item = this.rotinaTrabalho.find(r => r.id === this.editingRotinaId);
                                    return `
                                        <div class="grid gap-4">
                                            <div>
                                                <label class="block text-sm font-semibold mb-2 text-cm-escuro">Hor√°rio</label>
                                                <input type="text" id="editHorario" value="${item.horario}" placeholder="Ex: 08:00 √†s 08:30" class="w-full px-4 py-2 border rounded-lg focus:border-cm-turquesa" />
                                            </div>
                                            <div>
                                                <label class="block text-sm font-semibold mb-2 text-cm-escuro">Nome da Etiqueta</label>
                                                <input type="text" id="editEtiqueta" value="${item.etiqueta}" placeholder="Ex: Atendimento" class="w-full px-4 py-2 border rounded-lg focus:border-cm-turquesa" />
                                            </div>
                                            <div>
                                                <label class="block text-sm font-semibold mb-2 text-cm-escuro">Cor do Card</label>
                                                <select id="editCor" class="w-full px-4 py-2 border rounded-lg focus:border-cm-turquesa">
                                                    <option value="bg-green-500" ${item.cor === 'bg-green-500' ? 'selected' : ''}>üü¢ Verde</option>
                                                    <option value="bg-blue-500" ${item.cor === 'bg-blue-500' ? 'selected' : ''}>üîµ Azul</option>
                                                    <option value="bg-red-500" ${item.cor === 'bg-red-500' ? 'selected' : ''}>üî¥ Vermelho</option>
                                                    <option value="bg-yellow-500" ${item.cor === 'bg-yellow-500' ? 'selected' : ''}>üü° Amarelo</option>
                                                    <option value="bg-purple-500" ${item.cor === 'bg-purple-500' ? 'selected' : ''}>üü£ Roxo</option>
                                                    <option value="bg-orange-500" ${item.cor === 'bg-orange-500' ? 'selected' : ''}>üü† Laranja</option>
                                                    <option value="bg-pink-500" ${item.cor === 'bg-pink-500' ? 'selected' : ''}>ü©∑ Rosa</option>
                                                    <option value="bg-gray-500" ${item.cor === 'bg-gray-500' ? 'selected' : ''}>‚ö´ Cinza</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-semibold mb-2 text-cm-escuro">Tarefas (uma por linha)</label>
                                                <textarea id="editTarefas" rows="6" class="w-full px-4 py-2 border rounded-lg focus:border-cm-turquesa">${item.tarefas.join('\n')}</textarea>
                                            </div>
                                        </div>
                                        <div class="flex gap-2 mt-6">
                                            <button onclick="app.salvarEdicaoRotina()" class="flex-1 btn-cm text-white py-3 rounded-lg font-semibold">üíæ Salvar</button>
                                            <button onclick="app.fecharModalEditarRotina()" class="flex-1 bg-gray-400 text-white py-3 rounded-lg font-semibold">‚ùå Cancelar</button>
                                        </div>
                                    `;
                                })() : ''}
                            </div>
                        </div>
                    `;
                }

                else if (this.currentPage === 'vendas') {
                    const vendaEdit = this.editingId ? this.vendas.find(v => v.id === this.editingId) : null;

                    conteudo = `
                        <div>
                            <h2 class="text-2xl font-bold mb-6 text-cm-escuro">${this.editingId ? 'Editar' : 'Registrar Nova'} Reserva</h2>
                            
                            <div class="bg-white p-6 rounded-lg shadow mb-8">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <select id="tipoCliente" class="px-4 py-2 border rounded-lg focus:border-cm-turquesa">
                                        <option value="">Tipo de Cliente</option>
                                        <option value="Tr√°fego" ${vendaEdit?.tipoCliente === 'Tr√°fego' ? 'selected' : ''}>Tr√°fego</option>
                                        <option value="Org√¢nico" ${vendaEdit?.tipoCliente === 'Org√¢nico' ? 'selected' : ''}>Org√¢nico</option>
                                        <option value="Indica√ß√£o" ${vendaEdit?.tipoCliente === 'Indica√ß√£o' ? 'selected' : ''}>Indica√ß√£o</option>
                                        <option value="Google" ${vendaEdit?.tipoCliente === 'Google' ? 'selected' : ''}>Google</option>
                                    </select>
                                    <input type="text" id="nomeClienteVenda" placeholder="Nome do Cliente" value="${vendaEdit?.nomeCliente || ''}" class="px-4 py-2 border rounded-lg focus:border-cm-turquesa" />
                                    <div>
                                        <label class="block text-sm font-semibold mb-1 text-cm-escuro">Check-in</label>
                                        <input type="date" id="checkInVenda" value="${vendaEdit?.checkIn || ''}" class="w-full px-4 py-2 border rounded-lg focus:border-cm-turquesa" />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-1 text-cm-escuro">Check-out</label>
                                        <input type="date" id="checkOutVenda" value="${vendaEdit?.checkOut || ''}" class="w-full px-4 py-2 border rounded-lg focus:border-cm-turquesa" />
                                    </div>
                                    <input type="text" id="hotelVenda" placeholder="Hotel/Resort" value="${vendaEdit?.hotel || ''}" class="px-4 py-2 border rounded-lg focus:border-cm-turquesa" />
                                    <input type="number" id="valorVenda" placeholder="Valor (R$)" step="0.01" value="${vendaEdit?.valor || ''}" class="px-4 py-2 border rounded-lg focus:border-cm-turquesa" />
                                    <select id="situacaoVenda" class="px-4 py-2 border rounded-lg focus:border-cm-turquesa">
                                        <option value="">Situa√ß√£o</option>
                                        <option value="Confirmada" ${vendaEdit?.situacao === 'Confirmada' ? 'selected' : ''}>Confirmada</option>
                                        <option value="Pendente" ${vendaEdit?.situacao === 'Pendente' ? 'selected' : ''}>Pendente</option>
                                        <option value="Cancelada" ${vendaEdit?.situacao === 'Cancelada' ? 'selected' : ''}>Cancelada</option>
                                    </select>
                                    <input type="text" id="agenteVenda" placeholder="Agente Respons√°vel" value="${vendaEdit?.agente || ''}" class="px-4 py-2 border rounded-lg focus:border-cm-turquesa" />
                                    <input type="text" id="voucherVenda" placeholder="N¬∫ Voucher" value="${vendaEdit?.voucher || ''}" class="px-4 py-2 border rounded-lg focus:border-cm-turquesa" />
                                    <input type="date" id="dataConfirmacaoVenda" placeholder="Data de Confirma√ß√£o" value="${vendaEdit?.dataConfirmacao || this.getDataAtual()}" class="px-4 py-2 border rounded-lg focus:border-cm-turquesa" />
                                </div>
                                <textarea id="observacoesVenda" placeholder="Observa√ß√µes" class="w-full px-4 py-2 border rounded-lg focus:border-cm-turquesa" rows="3">${vendaEdit?.observacoes || ''}</textarea>
                                <button onclick="app.adicionarVenda()" class="w-full mt-6 btn-cm text-white py-3 rounded-lg font-semibold">${this.editingId ? '‚úèÔ∏è Atualizar' : '‚úÖ Registrar'} Reserva</button>
                                ${this.editingId ? '<button onclick="app.cancelarEdicao()" class="w-full mt-2 bg-gray-400 text-white py-2 rounded-lg">Cancelar</button>' : ''}
                            </div>

                            <div class="bg-white rounded-lg shadow overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead class="bg-cm-escuro text-white">
                                        <tr>
                                            <th class="px-4 py-3 text-left">Tipo</th>
                                            <th class="px-4 py-3 text-left">Cliente</th>
                                            <th class="px-4 py-3 text-left">Hotel</th>
                                            <th class="px-4 py-3 text-left">Valor</th>
                                            <th class="px-4 py-3 text-left">Situa√ß√£o</th>
                                            <th class="px-4 py-3 text-left">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${this.vendas.map((v, i) => `
                                            <tr class="border-b ${i % 2 === 0 ? 'bg-gray-50' : ''}">
                                                <td class="px-4 py-3">${v.tipoCliente}</td>
                                                <td class="px-4 py-3 font-semibold">${v.nomeCliente}</td>
                                                <td class="px-4 py-3">${v.hotel}</td>
                                                <td class="px-4 py-3 font-semibold text-cm-escuro">R$ ${v.valor.toFixed(2)}</td>
                                                <td class="px-4 py-3">${v.situacao}</td>
                                                <td class="px-4 py-3 flex gap-2">
                                                    <button onclick="app.editarVenda(${v.id})" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">‚úèÔ∏è</button>
                                                    <button onclick="app.deletarVenda(${v.id})" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">üóëÔ∏è</button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                }

                else if (this.currentPage === 'dashboard') {
                    const vendsFiltradas = this.getVendasFiltradas();
                    const totalVendido = vendsFiltradas.reduce((sum, v) => sum + parseFloat(v.valor || 0), 0);
                    const totalComissao = (totalVendido * this.comissaoPadrao) / 100;

                    conteudo = `
                        <div>
                            <h2 class="text-2xl font-bold mb-6 text-cm-escuro">Dashboard de Vendas</h2>
                            
                            <div class="bg-white p-6 rounded-lg shadow mb-8">
                                <h3 class="text-lg font-bold mb-4 text-cm-escuro">üìÖ Filtrar por Per√≠odo</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-semibold mb-2 text-cm-escuro">Data In√≠cio</label>
                                        <input type="date" id="filtroInicio" value="${this.filtroDataInicio}" class="w-full px-4 py-2 border rounded-lg focus:border-cm-turquesa" />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2 text-cm-escuro">Data Fim</label>
                                        <input type="date" id="filtroFim" value="${this.filtroDataFim}" class="w-full px-4 py-2 border rounded-lg focus:border-cm-turquesa" />
                                    </div>
                                    <div class="flex items-end">
                                        <button onclick="app.filtroDataInicio = app.getDataMesAtual(); app.filtroDataFim = app.getDataAtual(); app.render();" class="w-full bg-cm-escuro hover:opacity-90 text-white py-2 rounded-lg font-semibold">M√™s Atual</button>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                                <div class="bg-white p-6 rounded-lg shadow border-t-4 border-cm-laranja">
                                    <p class="text-gray-600">Total Vendido</p>
                                    <p class="text-3xl font-bold text-cm-escuro">R$ ${totalVendido.toFixed(2)}</p>
                                    <p class="text-xs text-gray-500 mt-2">${vendsFiltradas.length} reservas</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow border-t-4 border-cm-verde">
                                    <p class="text-gray-600">Comiss√£o ${this.comissaoPadrao}%</p>
                                    <p class="text-3xl font-bold text-cm-escuro">R$ ${totalComissao.toFixed(2)}</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow border-t-4 border-cm-turquesa">
                                    <p class="text-gray-600">Ticket M√©dio</p>
                                    <p class="text-3xl font-bold text-cm-escuro">R$ ${(vendsFiltradas.length > 0 ? totalVendido / vendsFiltradas.length : 0).toFixed(2)}</p>
                                </div>
                            </div>

                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-xl font-bold text-cm-escuro">Reservas do Per√≠odo</h3>
                                    ${vendsFiltradas.length > 0 ? '<button onclick="app.exportarExcel()" class="bg-cm-verde hover:opacity-90 text-cm-escuro px-4 py-2 rounded-lg font-semibold">üì• Exportar Excel</button>' : ''}
                                </div>
                                ${vendsFiltradas.length === 0 ? '<p class="text-gray-500">Nenhuma reserva neste per√≠odo</p>' : `
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm">
                                            <thead class="bg-cm-escuro text-white">
                                                <tr>
                                                    <th class="px-4 py-2 text-left">Tipo</th>
                                                    <th class="px-4 py-2 text-left">Cliente</th>
                                                    <th class="px-4 py-2 text-left">Check-in</th>
                                                    <th class="px-4 py-2 text-left">Hotel</th>
                                                    <th class="px-4 py-2 text-left">Valor</th>
                                                    <th class="px-4 py-2 text-left">Situa√ß√£o</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${vendsFiltradas.map((v, i) => `
                                                    <tr class="border-b ${i % 2 === 0 ? 'bg-gray-50' : ''}">
                                                        <td class="px-4 py-2">${v.tipoCliente}</td>
                                                        <td class="px-4 py-2 font-semibold">${v.nomeCliente}</td>
                                                        <td class="px-4 py-2">${v.checkIn}</td>
                                                        <td class="px-4 py-2">${v.hotel}</td>
                                                        <td class="px-4 py-2 font-semibold text-cm-escuro">R$ ${v.valor.toFixed(2)}</td>
                                                        <td class="px-4 py-2"><span class="px-2 py-1 rounded text-xs ${v.situacao === 'Confirmada' ? 'bg-green-100 text-green-800' : v.situacao === 'Pendente' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">${v.situacao}</span></td>
                                                    </tr>
                                                `).join('')}
                                            </tbody>
                                        </table>
                                    </div>
                                `}
                            </div>
                        </div>
                    `;
                }

                else if (this.currentPage === 'config') {
                    conteudo = `
                        <div>
                            <h2 class="text-2xl font-bold mb-6 text-cm-escuro">Configura√ß√µes</h2>
                            <div class="bg-white p-6 rounded-lg shadow max-w-md">
                                <h3 class="text-xl font-bold mb-4 text-cm-escuro">Comiss√£o Padr√£o</h3>
                                <div class="mb-4">
                                    <label class="block text-sm font-semibold mb-2 text-cm-escuro">Percentual de Comiss√£o (%)</label>
                                    <input type="number" id="comissaoConfig" step="0.1" value="${this.comissaoPadrao}" class="w-full px-4 py-2 border rounded-lg focus:border-cm-turquesa" />
                                </div>
                                <button onclick="app.atualizarComissao()" class="w-full btn-cm text-white py-2 rounded-lg mb-4 font-semibold">Salvar Comiss√£o</button>
                                <p class="text-gray-600 text-sm mb-6">Esta comiss√£o ser√° aplicada automaticamente em todas as vendas</p>
                                
                                <div class="mt-8 pt-8 border-t">
                                    <p class="text-gray-600 mb-4">Total de reservas: <strong>${this.vendas.length}</strong></p>
                                    <p class="text-gray-600 mb-4">Blocos de rotina: <strong>${this.rotinaTrabalho.length}</strong></p>
                                    <p class="text-gray-600 mb-4">Hist√≥rico de dias: <strong>${this.historicoDesempenho.length}</strong></p>
                                    <button onclick="if(confirm('Limpar todos os dados?')) { app.vendas = []; app.historicoDesempenho = []; app.salvarDados(); app.render(); }" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700">üóëÔ∏è Limpar Todos os Dados</button>
                                </div>
                            </div>
                        </div>
                    `;
                }

                app.innerHTML = `
                    <div class="min-h-screen bg-gray-50">
                        <div class="bg-cm-escuro text-white shadow-lg">
                            <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
                                <div class="flex items-center gap-4">
                                    <div class="flex gap-1">
                                        <div class="w-8 h-10 bg-cm-laranja rounded flex items-center justify-center">
                                            <span class="text-cm-escuro text-xl font-bold">C</span>
                                        </div>
                                        <div class="w-8 h-10 bg-cm-verde rounded flex items-center justify-center">
                                            <span class="text-cm-escuro text-xl font-bold">&</span>
                                        </div>
                                        <div class="w-8 h-10 bg-cm-turquesa rounded flex items-center justify-center">
                                            <span class="text-cm-escuro text-xl font-bold">M</span>
                                        </div>
                                    </div>
                                    <div>
                                        <h1 class="text-xl font-bold">Controle de Consultor</h1>
                                        <p class="text-xs text-gray-300">Ol√°, ${this.userName}!</p>
                                    </div>
                                </div>
                                <button onclick="app.logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg text-sm">üö™ Sair</button>
                            </div>
                        </div>

                        <div class="bg-white shadow border-b">
                            <div class="max-w-6xl mx-auto flex gap-4 px-4 py-3 overflow-x-auto">
                                <button onclick="app.currentPage = 'desempenho'; app.render();" class="px-4 py-2 rounded-lg whitespace-nowrap font-semibold ${this.currentPage === 'desempenho' ? 'bg-cm-turquesa text-white' : 'bg-gray-200 text-gray-700'}">üìä Desempenho</button>
                                <button onclick="app.currentPage = 'rotina'; app.render();" class="px-4 py-2 rounded-lg whitespace-nowrap font-semibold ${this.currentPage === 'rotina' ? 'bg-cm-turquesa text-white' : 'bg-gray-200 text-gray-700'}">‚úÖ Rotina</button>
                                <button onclick="app.currentPage = 'dashboard'; app.render();" class="px-4 py-2 rounded-lg whitespace-nowrap font-semibold ${this.currentPage === 'dashboard' ? 'bg-cm-turquesa text-white' : 'bg-gray-200 text-gray-700'}">üí∞ Vendas</button>
                                <button onclick="app.currentPage = 'vendas'; app.render();" class="px-4 py-2 rounded-lg whitespace-nowrap font-semibold ${this.currentPage === 'vendas' ? 'bg-cm-turquesa text-white' : 'bg-gray-200 text-gray-700'}">üé´ Reservas</button>
                                <button onclick="app.currentPage = 'config'; app.render();" class="px-4 py-2 rounded-lg whitespace-nowrap font-semibold ${this.currentPage === 'config' ? 'bg-cm-turquesa text-white' : 'bg-gray-200 text-gray-700'}">üîß Config</button>
                            </div>
                        </div>

                        <div class="max-w-6xl mx-auto px-4 py-8">
                            ${conteudo}
                        </div>
                    </div>
                `;

                this.adicionarListeners();
            }

            adicionarListeners() {
                const filtroInicio = document.getElementById('filtroInicio');
                const filtroFim = document.getElementById('filtroFim');
                if (filtroInicio) {
                    filtroInicio.addEventListener('change', (e) => {
                        this.filtroDataInicio = e.target.value;
                        this.render();
                    });
                }
                if (filtroFim) {
                    filtroFim.addEventListener('change', (e) => {
                        this.filtroDataFim = e.target.value;
                        this.render();
                    });
                }
            }

            adicionarVenda() {
                const tipoCliente = document.getElementById('tipoCliente')?.value || '';
                const nomeCliente = document.getElementById('nomeClienteVenda')?.value || '';
                const checkIn = document.getElementById('checkInVenda')?.value || '';
                const checkOut = document.getElementById('checkOutVenda')?.value || '';
                const hotel = document.getElementById('hotelVenda')?.value || '';
                const valor = parseFloat(document.getElementById('valorVenda')?.value || 0);
                const situacao = document.getElementById('situacaoVenda')?.value || '';
                const agente = document.getElementById('agenteVenda')?.value || '';
                const voucher = document.getElementById('voucherVenda')?.value || '';
                const dataConfirmacao = document.getElementById('dataConfirmacaoVenda')?.value || '';
                const observacoes = document.getElementById('observacoesVenda')?.value || '';

                if (!tipoCliente || !nomeCliente || !checkIn || !checkOut || !hotel || !valor || !situacao || !agente || !voucher || !dataConfirmacao) {
                    alert('Preencha todos os campos obrigat√≥rios!');
                    return;
                }

                if (this.editingId) {
                    const index = this.vendas.findIndex(v => v.id === this.editingId);
                    this.vendas[index] = {
                        id: this.editingId,
                        tipoCliente,
                        nomeCliente,
                        checkIn,
                        checkOut,
                        hotel,
                        valor,
                        situacao,
                        agente,
                        voucher,
                        dataConfirmacao,
                        observacoes
                    };
                    this.editingId = null;
                    alert('Reserva atualizada!');
                } else {
                    this.vendas.push({
                        id: Date.now(),
                        tipoCliente,
                        nomeCliente,
                        checkIn,
                        checkOut,
                        hotel,
                        valor,
                        situacao,
                        agente,
                        voucher,
                        dataConfirmacao,
                        observacoes
                    });
                    alert('Reserva registrada!');
                }

                this.salvarDados();
                this.render();
            }

            editarVenda(id) {
                this.editingId = id;
                this.currentPage = 'vendas';
                this.render();
            }

            cancelarEdicao() {
                this.editingId = null;
                this.render();
            }

            deletarVenda(id) {
                if (confirm('Deletar reserva?')) {
                    this.vendas = this.vendas.filter(v => v.id !== id);
                    this.salvarDados();
                    this.render();
                }
            }

            atualizarComissao() {
                const novaComissao = parseFloat(document.getElementById('comissaoConfig')?.value || 5);
                this.comissaoPadrao = novaComissao;
                this.salvarDados();
                alert(`Comiss√£o atualizada para ${novaComissao}%!`);
                this.render();
            }
        }

        const app = new ControlConsultor();
    </script>
</body>
</html>
