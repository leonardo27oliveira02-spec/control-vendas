<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Vendas - App</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div id="app"></div>

    <script>
        // APP INTEIRO EM VANILLA JS
        class ControlVendas {
            constructor() {
                this.loggedIn = false;
                this.userName = '';
                this.currentPage = 'dashboard';
                this.clientes = [];
                this.vendas = [];
                this.comissaoPadrao = 15;
                this.camposPersonalizados = [];
                this.filtroDataInicio = this.getDataMesAtual();
                this.filtroDataFim = this.getDataAtual();
                
                this.carregarDados();
                this.render();
            }

            getDataAtual() {
                return new Date().toISOString().split('T')[0];
            }

            getDataMesAtual() {
                const hoje = new Date();
                const primeiroDia = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                return primeiroDia.toISOString().split('T')[0];
            }

            carregarDados() {
                const dados = localStorage.getItem('appVendas');
                if (dados) {
                    const { clientes, vendas, comissao, camposPersonalizados } = JSON.parse(dados);
                    this.clientes = clientes || [];
                    this.vendas = vendas || [];
                    this.comissaoPadrao = comissao || 15;
                    this.camposPersonalizados = camposPersonalizados || [];
                }
            }

            salvarDados() {
                localStorage.setItem('appVendas', JSON.stringify({
                    clientes: this.clientes,
                    vendas: this.vendas,
                    comissao: this.comissaoPadrao,
                    camposPersonalizados: this.camposPersonalizados
                }));
            }

            login(nome) {
                if (nome.trim()) {
                    this.userName = nome;
                    this.loggedIn = true;
                    this.render();
                }
            }

            logout() {
                this.loggedIn = false;
                this.userName = '';
                this.render();
            }

            getNomeCliente(id) {
                const cliente = this.clientes.find(c => c.id == id);
                return cliente ? cliente.nome : 'Cliente n√£o encontrado';
            }

            getVendasFiltradas() {
                return this.vendas.filter(v => {
                    const dataVenda = new Date(v.dataVenda);
                    const dataInicio = new Date(this.filtroDataInicio);
                    const dataFim = new Date(this.filtroDataFim);
                    dataFim.setHours(23, 59, 59, 999);
                    return dataVenda >= dataInicio && dataVenda <= dataFim;
                });
            }

            exportarCSV() {
                const vendsFiltradas = this.getVendasFiltradas();
                const dataAtual = new Date().toLocaleDateString('pt-BR');
                
                const linhas = [];
                linhas.push(['RELAT√ìRIO DE VENDAS', dataAtual]);
                linhas.push(['Agente:', this.userName]);
                linhas.push(['Per√≠odo:', `${this.filtroDataInicio} a ${this.filtroDataFim}`]);
                linhas.push(['']);
                linhas.push(['N¬∫ RESERVA', 'CLIENTE', 'CHECK-IN', 'CHECK-OUT', 'DIAS', 'VALOR VENDA', 'COMISS√ÉO %', 'COMISS√ÉO R$']);
                
                vendsFiltradas.forEach(v => {
                    linhas.push([
                        v.numeroReserva,
                        this.getNomeCliente(v.clienteId),
                        v.checkIn,
                        v.checkOut,
                        v.dias,
                        v.valorTotal.toFixed(2),
                        v.comissao,
                        v.valorComissao.toFixed(2)
                    ]);
                });
                
                linhas.push(['']);
                linhas.push(['RESUMO DO PER√çODO']);
                linhas.push(['Total de Vendas', vendsFiltradas.length]);
                
                const totalVendido = vendsFiltradas.reduce((sum, v) => sum + parseFloat(v.valorTotal || 0), 0);
                const totalComissao = vendsFiltradas.reduce((sum, v) => sum + parseFloat(v.valorComissao || 0), 0);
                
                linhas.push(['Valor Total de Vendas (R$)', totalVendido.toFixed(2)]);
                linhas.push(['Valor Total de Comiss√£o (R$)', totalComissao.toFixed(2)]);
                
                let csv = linhas.map(linha => linha.map(cell => `"${cell}"`).join(',')).join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `relatorio_vendas_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                window.URL.revokeObjectURL(url);
            }

            render() {
                const app = document.getElementById('app');
                
                if (!this.loggedIn) {
                    app.innerHTML = `
                        <div class="min-h-screen bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center p-4">
                            <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md">
                                <h1 class="text-3xl font-bold text-center text-blue-600 mb-8">üì± Control Vendas</h1>
                                <p class="text-gray-600 text-center mb-6">Gerencie suas vendas de hospedagem</p>
                                <input type="text" id="loginInput" placeholder="Digite seu nome" class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:border-blue-500" />
                                <button onclick="app.login(document.getElementById('loginInput').value)" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">Entrar</button>
                            </div>
                        </div>
                    `;
                    return;
                }

                let conteudo = '';

                // DASHBOARD
                if (this.currentPage === 'dashboard') {
                    const vendsFiltradas = this.getVendasFiltradas();
                    const totalVendido = vendsFiltradas.reduce((sum, v) => sum + parseFloat(v.valorTotal || 0), 0);
                    const totalComissao = vendsFiltradas.reduce((sum, v) => sum + parseFloat(v.valorComissao || 0), 0);

                    conteudo = `
                        <div>
                            <h2 class="text-2xl font-bold mb-6">Dashboard</h2>
                            
                            <div class="bg-white p-6 rounded-lg shadow mb-8">
                                <h3 class="text-lg font-bold mb-4">üìÖ Filtrar por Per√≠odo</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Data In√≠cio</label>
                                        <input type="date" id="filtroInicio" value="${this.filtroDataInicio}" class="w-full px-4 py-2 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Data Fim</label>
                                        <input type="date" id="filtroFim" value="${this.filtroDataFim}" class="w-full px-4 py-2 border rounded-lg" />
                                    </div>
                                    <div class="flex items-end">
                                        <button onclick="app.filtroDataInicio = app.getDataMesAtual(); app.filtroDataFim = app.getDataAtual(); app.render();" class="w-full bg-gray-500 hover:bg-gray-600 text-white py-2 rounded-lg font-semibold">M√™s Atual</button>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                                <div class="bg-white p-6 rounded-lg shadow">
                                    <p class="text-gray-600">Total Vendido</p>
                                    <p class="text-3xl font-bold text-blue-600">R$ ${totalVendido.toFixed(2)}</p>
                                    <p class="text-xs text-gray-500 mt-2">${vendsFiltradas.length} vendas</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow">
                                    <p class="text-gray-600">Total Comiss√£o</p>
                                    <p class="text-3xl font-bold text-green-600">R$ ${totalComissao.toFixed(2)}</p>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow">
                                    <p class="text-gray-600">Ticket M√©dio</p>
                                    <p class="text-3xl font-bold text-purple-600">R$ ${(vendsFiltradas.length > 0 ? totalVendido / vendsFiltradas.length : 0).toFixed(2)}</p>
                                </div>
                            </div>

                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-xl font-bold">Vendas do Per√≠odo</h3>
                                    ${vendsFiltradas.length > 0 ? '<button onclick="app.exportarCSV()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">üì• Exportar</button>' : ''}
                                </div>
                                ${vendsFiltradas.length === 0 ? '<p class="text-gray-500">Nenhuma venda neste per√≠odo</p>' : `
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm">
                                            <thead class="bg-gray-100">
                                                <tr>
                                                    <th class="px-4 py-2 text-left">N¬∫ Reserva</th>
                                                    <th class="px-4 py-2 text-left">Cliente</th>
                                                    <th class="px-4 py-2 text-left">Check-in</th>
                                                    <th class="px-4 py-2 text-left">Check-out</th>
                                                    <th class="px-4 py-2 text-left">Valor</th>
                                                    <th class="px-4 py-2 text-left">Comiss√£o</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${vendsFiltradas.map(v => `
                                                    <tr class="border-b">
                                                        <td class="px-4 py-2 font-semibold">${v.numeroReserva}</td>
                                                        <td class="px-4 py-2">${this.getNomeCliente(v.clienteId)}</td>
                                                        <td class="px-4 py-2">${v.checkIn}</td>
                                                        <td class="px-4 py-2">${v.checkOut}</td>
                                                        <td class="px-4 py-2 font-semibold">R$ ${v.valorTotal.toFixed(2)}</td>
                                                        <td class="px-4 py-2 text-green-600 font-bold">R$ ${v.valorComissao.toFixed(2)}</td>
                                                    </tr>
                                                `).join('')}
                                            </tbody>
                                        </table>
                                    </div>
                                `}
                            </div>
                        </div>
                    `;
                }

                // CLIENTES
                else if (this.currentPage === 'clientes') {
                    conteudo = `
                        <div>
                            <h2 class="text-2xl font-bold mb-6">Gerenciar Clientes</h2>
                            
                            <div class="bg-white p-6 rounded-lg shadow mb-8">
                                <h3 class="text-xl font-bold mb-4">Adicionar Novo Cliente</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <input type="text" id="nomeCliente" placeholder="Nome completo" class="px-4 py-2 border rounded-lg" />
                                    <input type="tel" id="telefoneCliente" placeholder="Telefone" class="px-4 py-2 border rounded-lg" />
                                    <input type="text" id="cpfCliente" placeholder="CPF" class="px-4 py-2 border rounded-lg" />
                                    <input type="email" id="emailCliente" placeholder="Email" class="px-4 py-2 border rounded-lg" />
                                </div>
                                <button onclick="app.adicionarCliente()" class="mt-4 w-full bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700">+ Adicionar Cliente</button>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${this.clientes.map(c => `
                                    <div class="bg-white p-4 rounded-lg shadow">
                                        <h4 class="font-bold text-lg mb-2">${c.nome}</h4>
                                        <p class="text-gray-600 text-sm">üì± ${c.telefone}</p>
                                        <p class="text-gray-600 text-sm">üìß ${c.email || 'N/A'}</p>
                                        <button onclick="app.deletarCliente(${c.id})" class="mt-3 w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600">üóëÔ∏è Deletar</button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                // VENDAS
                else if (this.currentPage === 'vendas') {
                    conteudo = `
                        <div>
                            <h2 class="text-2xl font-bold mb-6">Registrar Venda</h2>
                            
                            <div class="bg-white p-6 rounded-lg shadow mb-8">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <input type="text" id="nReserva" placeholder="N¬∫ da Reserva" class="px-4 py-2 border rounded-lg" />
                                    <select id="clienteVenda" class="px-4 py-2 border rounded-lg">
                                        <option value="">Selecionar Cliente</option>
                                        ${this.clientes.map(c => `<option value="${c.id}">${c.nome}</option>`).join('')}
                                    </select>
                                    <input type="text" id="hotelVenda" placeholder="Hotel/Resort" class="px-4 py-2 border rounded-lg" />
                                    <input type="date" id="checkInVenda" class="px-4 py-2 border rounded-lg" />
                                    <input type="date" id="checkOutVenda" class="px-4 py-2 border rounded-lg" />
                                    <input type="number" id="valorVenda" placeholder="Valor Total (R$)" step="0.01" class="px-4 py-2 border rounded-lg" />
                                    <input type="number" id="comissaoVenda" placeholder="Comiss√£o (%)" step="0.1" value="${this.comissaoPadrao}" class="px-4 py-2 border rounded-lg" />
                                </div>
                                <button onclick="app.adicionarVenda()" class="w-full mt-6 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700">‚úÖ Registrar Venda</button>
                            </div>

                            <div class="bg-white rounded-lg shadow overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead class="bg-gray-100">
                                        <tr>
                                            <th class="px-4 py-3 text-left">N¬∫ Reserva</th>
                                            <th class="px-4 py-3 text-left">Cliente</th>
                                            <th class="px-4 py-3 text-left">Valor</th>
                                            <th class="px-4 py-3 text-left">Comiss√£o</th>
                                            <th class="px-4 py-3 text-left">A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${this.vendas.map(v => `
                                            <tr class="border-b">
                                                <td class="px-4 py-3 font-semibold">${v.numeroReserva}</td>
                                                <td class="px-4 py-3">${this.getNomeCliente(v.clienteId)}</td>
                                                <td class="px-4 py-3">R$ ${v.valorTotal.toFixed(2)}</td>
                                                <td class="px-4 py-3 text-green-600 font-bold">R$ ${v.valorComissao.toFixed(2)}</td>
                                                <td class="px-4 py-3">
                                                    <button onclick="app.deletarVenda(${v.id})" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">üóëÔ∏è</button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                }

                // CONFIG
                else if (this.currentPage === 'config') {
                    conteudo = `
                        <div>
                            <h2 class="text-2xl font-bold mb-6">Configura√ß√µes</h2>
                            <div class="bg-white p-6 rounded-lg shadow max-w-md">
                                <h3 class="text-xl font-bold mb-4">Comiss√£o Padr√£o</h3>
                                <input type="number" id="comissaoConfig" step="0.1" value="${this.comissaoPadrao}" class="w-full px-4 py-2 border rounded-lg mb-4" />
                                <button onclick="app.atualizarComissao()" class="w-full bg-blue-600 text-white py-2 rounded-lg mb-4">Salvar</button>
                                
                                <div class="mt-8 pt-8 border-t">
                                    <p class="text-gray-600 mb-4">Total de clientes: <strong>${this.clientes.length}</strong></p>
                                    <p class="text-gray-600 mb-4">Total de vendas: <strong>${this.vendas.length}</strong></p>
                                    <button onclick="if(confirm('Limpar todos os dados?')) { app.clientes = []; app.vendas = []; app.salvarDados(); app.render(); }" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700">üóëÔ∏è Limpar Dados</button>
                                </div>
                            </div>
                        </div>
                    `;
                }

                app.innerHTML = `
                    <div class="min-h-screen bg-gray-100">
                        <div class="bg-blue-600 text-white shadow-lg">
                            <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
                                <div>
                                    <h1 class="text-2xl font-bold">üì± Control Vendas</h1>
                                    <p class="text-blue-100">Bem-vindo, ${this.userName}!</p>
                                </div>
                                <button onclick="app.logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg">üö™ Sair</button>
                            </div>
                        </div>

                        <div class="bg-white shadow border-b">
                            <div class="max-w-6xl mx-auto flex gap-4 px-4 py-3 overflow-x-auto">
                                <button onclick="app.currentPage = 'dashboard'; app.render();" class="px-4 py-2 rounded-lg whitespace-nowrap ${this.currentPage === 'dashboard' ? 'bg-blue-600 text-white' : 'bg-gray-200'}">üìä Dashboard</button>
                                <button onclick="app.currentPage = 'clientes'; app.render();" class="px-4 py-2 rounded-lg whitespace-nowrap ${this.currentPage === 'clientes' ? 'bg-blue-600 text-white' : 'bg-gray-200'}">üë• Clientes</button>
                                <button onclick="app.currentPage = 'vendas'; app.render();" class="px-4 py-2 rounded-lg whitespace-nowrap ${this.currentPage === 'vendas' ? 'bg-blue-600 text-white' : 'bg-gray-200'}">üí∞ Vendas</button>
                                <button onclick="app.currentPage = 'config'; app.render();" class="px-4 py-2 rounded-lg whitespace-nowrap ${this.currentPage === 'config' ? 'bg-blue-600 text-white' : 'bg-gray-200'}">üîß Config</button>
                            </div>
                        </div>

                        <div class="max-w-6xl mx-auto px-4 py-8">
                            ${conteudo}
                        </div>
                    </div>
                `;

                // Adiciona listeners ap√≥s renderizar
                this.adicionarListeners();
            }

            adicionarListeners() {
                const filtroInicio = document.getElementById('filtroInicio');
                const filtroFim = document.getElementById('filtroFim');
                if (filtroInicio) {
                    filtroInicio.addEventListener('change', (e) => {
                        this.filtroDataInicio = e.target.value;
                        this.render();
                    });
                }
                if (filtroFim) {
                    filtroFim.addEventListener('change', (e) => {
                        this.filtroDataFim = e.target.value;
                        this.render();
                    });
                }
            }

            adicionarCliente() {
                const nome = document.getElementById('nomeCliente')?.value || '';
                const telefone = document.getElementById('telefoneCliente')?.value || '';
                const cpf = document.getElementById('cpfCliente')?.value || '';
                const email = document.getElementById('emailCliente')?.value || '';

                if (nome && telefone) {
                    this.clientes.push({
                        id: Date.now(),
                        nome,
                        telefone,
                        cpf,
                        email,
                        dataContato: this.getDataAtual()
                    });
                    this.salvarDados();
                    this.render();
                    alert('Cliente adicionado!');
                }
            }

            deletarCliente(id) {
                if (confirm('Deletar cliente?')) {
                    this.clientes = this.clientes.filter(c => c.id !== id);
                    this.salvarDados();
                    this.render();
                }
            }

            adicionarVenda() {
                const numeroReserva = document.getElementById('nReserva')?.value || '';
                const clienteId = document.getElementById('clienteVenda')?.value || '';
                const hotel = document.getElementById('hotelVenda')?.value || '';
                const checkIn = document.getElementById('checkInVenda')?.value || '';
                const checkOut = document.getElementById('checkOutVenda')?.value || '';
                const valorVenda = document.getElementById('valorVenda')?.value || '';
                const comissao = parseFloat(document.getElementById('comissaoVenda')?.value || this.comissaoPadrao);

                if (!numeroReserva || !clienteId || !hotel || !checkIn || !checkOut || !valorVenda) {
                    alert('Preencha todos os campos!');
                    return;
                }

                const ci = new Date(checkIn);
                const co = new Date(checkOut);
                const dias = Math.ceil((co - ci) / (1000 * 60 * 60 * 24));

                if (dias <= 0) {
                    alert('Data de sa√≠da deve ser depois da data de entrada!');
                    return;
                }

                const valorTotal = parseFloat(valorVenda);
                const valorComissao = (valorTotal * comissao) / 100;

                this.vendas.push({
                    id: Date.now(),
                    numeroReserva,
                    clienteId,
                    hotel,
                    checkIn,
                    checkOut,
                    dias,
                    valorTotal,
                    valorComissao,
                    comissao,
                    dataVenda: this.getDataAtual()
                });

                this.salvarDados();
                this.render();
                alert('Venda registrada!');
            }

            deletarVenda(id) {
                if (confirm('Deletar venda?')) {
                    this.vendas = this.vendas.filter(v => v.id !== id);
                    this.salvarDados();
                    this.render();
                }
            }

            atualizarComissao() {
                const novaComissao = parseFloat(document.getElementById('comissaoConfig')?.value || 15);
                this.comissaoPadrao = novaComissao;
                this.salvarDados();
                alert('Comiss√£o atualizada!');
                this.render();
            }
        }

        const app = new ControlVendas();
    </script>
</body>
</html>
```

